---

- hosts: 127.0.0.1
  connection: local
  sudo: true
  vars_files:
    - ../config.yml

  tasks:
    - name: Adding apt keys
      loop: '{{ apt.repos }}'
      apt_key:
        url: '{{ item.gpg }}'
      when: item.gpg is defined

    - name: 'Add PPA repositories.'
      loop: '{{ apt.repos }}'
      apt_repository:
        repo: '{{ item.repo }}'
        filename: '{{ item.filename }}'
        state: present

    - name: Make sure broken packages are fixed
      shell: 'apt --fix-broken install'
      sudo: true
        
    - name: 'Update apt cache...'
      apt:
        update_cache: yes
        state: fixed
        force: true
        
    - name: 'Install packages...'
      apt:
        pkg: '{{ apt.packages.install.list }}'

    - name: 'Install DEB packages...'
      loop: '{{ apt.packages.install.deb }}'
      apt:
        deb: '{{ item }}'
